22:07:57|RAP|WARN|: Dangling pointer detected in function "leave"
warning: Dangling pointer detected.
   --> src/driver/base/kset.rs:109:1
    |
109 | / pub fn leave(&self, kobj: &Arc<dyn KObject>) {
110 | |         let mut kobjects = self.kobjects.write();
111 | |         kobjects.retain(|x| x.upgrade().is_some());
112 | |         let index = kobjects.iter().position(|x| {
113 | |             if let Some(x) = x.upgrade() {
114 | |                 return Arc::ptr_eq(&x, kobj);
115 | |             }
116 | |             return false;
117 | |         });
118 | |         if let Some(index) = index {
119 | |             let x = kobjects.remove(index);
120 | |             let x = x.upgrade().unwrap();
121 | |             drop(kobjects);
122 | |             x.set_kset(None);
123 | |         }
124 | |     }
    | |_____- Dangling pointer (confidence 99%): Location in file src/driver/base/kset.rs line 109.
    | MIR detail: Value UNKNWON(_18446744073709551615) in leave and _1(self, src/driver/base/kset.rs:109) are alias.
    | MIR detail: UNKNWON(_18446744073709551615) in leave is dropped at BB18446744073709551615(src/driver/base/kset.rs:109); _1(self, src/driver/base/kset.rs:109) became dangling.
    |
22:07:57|RAP|WARN|: Dangling pointer detected during unwinding in function "leave"
warning: Dangling pointer detected during unwinding.
   --> src/driver/base/kset.rs:109:1
    |
109 | / pub fn leave(&self, kobj: &Arc<dyn KObject>) {
110 | |         let mut kobjects = self.kobjects.write();
111 | |         kobjects.retain(|x| x.upgrade().is_some());
112 | |         let index = kobjects.iter().position(|x| {
113 | |             if let Some(x) = x.upgrade() {
114 | |                 return Arc::ptr_eq(&x, kobj);
115 | |             }
116 | |             return false;
117 | |         });
118 | |         if let Some(index) = index {
119 | |             let x = kobjects.remove(index);
120 | |             let x = x.upgrade().unwrap();
121 | |             drop(kobjects);
122 | |             x.set_kset(None);
123 | |         }
124 | |     }
    | |_____- Dangling pointer (confidence 99%): Location in file src/driver/base/kset.rs line 109.
    | MIR detail: Value UNKNWON(_18446744073709551615) in leave and _1(self, src/driver/base/kset.rs:109) are alias.
    | MIR detail: UNKNWON(_18446744073709551615) in leave is dropped at BB18446744073709551615(src/driver/base/kset.rs:109); _1(self, src/driver/base/kset.rs:109) became dangling.
    |
render dot for DefId(0:8427 ~ dragonos_kernel[9e38]::driver::base::kset::{impl#3}::leave)
