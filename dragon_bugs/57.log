22:08:05|RAP|WARN|: Dangling pointer detected during unwinding in function "read_at"
warning: Dangling pointer detected during unwinding.
   --> src/filesystem/kernfs/mod.rs:344:1
    |
344 | / fn read_at(
345 | |         &self,
346 | |         offset: usize,
347 | |         len: usize,
348 | |         buf: &mut [u8],
349 | |         data: SpinLockGuard<FilePrivateData>,
350 | |     ) -> Result<usize, SystemError> {
351 | |         if self.inode_type == KernInodeType::SymLink {
352 | |             let inner = self.inner.read();
353 | |             if offset >= inner.symlink_target_absolute_path.as_ref().unwrap().len() {
354 | |                 return Ok(0);
355 | |             }
356 | |             let len = min(len, buf.len());
357 | |             let len = min(
358 | |                 len,
359 | |                 inner.symlink_target_absolute_path.as_ref().unwrap().len() - offset,
360 | |             );
361 | |             buf[0..len].copy_from_slice(
362 | |                 &inner
363 | |                     .symlink_target_absolute_path
364 | |                     .as_ref()
365 | |                     .unwrap()
366 | |                     .as_bytes()[offset..offset + len],
367 | |             );
368 | |             return Ok(len);
369 | |         }
370 | |         if self.inode_type != KernInodeType::File {
371 | |             return Err(SystemError::EISDIR);
372 | |         }
373 | |
374 | |         if self.callback.is_none() {
375 | |             warn!("kernfs: callback is none");
376 | |             return Err(SystemError::ENOSYS);
377 | |         }
378 | |         // release the private data lock before calling the callback
379 | |         drop(data);
380 | |
381 | |         let callback_data =
382 | |             KernCallbackData::new(self.self_ref.upgrade().unwrap(), self.private_data.lock());
383 | |         return self
384 | |             .callback
385 | |             .as_ref()
386 | |             .unwrap()
387 | |             .read(callback_data, &mut buf[..len], offset);
388 | |     }
    | |_____- Dangling pointer (confidence 99%): Location in file src/filesystem/kernfs/mod.rs line 344.
    | MIR detail: Value UNKNWON(_18446744073709551615) in read_at and _1(self, src/filesystem/kernfs/mod.rs:345) are alias.
    | MIR detail: UNKNWON(_18446744073709551615) in read_at is dropped at BB18446744073709551615(src/filesystem/kernfs/mod.rs:344); _1(self, src/filesystem/kernfs/mod.rs:345) became dangling.
    |
render dot for DefId(0:18155 ~ dragonos_kernel[9e38]::filesystem::kernfs::{impl#2}::read_at)
